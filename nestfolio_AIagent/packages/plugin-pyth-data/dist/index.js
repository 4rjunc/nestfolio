import A from'chalk';import Rt from'cli-table3';import un from'ora';import {elizaLogger}from'@elizaos/core';import {HermesClient}from'@pythnetwork/hermes-client';import Kr from'ajv';var be=class extends Error{constructor(t,n,a="MEDIUM",s,i){super(n);this.code=t;this.message=n;this.severity=a;this.details=s;this.originalError=i;this.timestamp=Date.now(),Object.setPrototypeOf(this,new.target.prototype);}timestamp;name="PythError";toJSON(){return {name:this.name,code:this.code,message:this.message,severity:this.severity,timestamp:this.timestamp,details:this.details,stack:this.stack,originalError:this.originalError?{name:this.originalError.name,message:this.originalError.message,stack:this.originalError.stack}:undefined}}};var h=class r extends be{name="DataError";constructor(e,t,n="MEDIUM",a,s){super(e,t,n,a,s),Object.setPrototypeOf(this,new.target.prototype);}static invalidSubscription(e,t){return new r("DATA_INVALID_SUBSCRIPTION","Invalid subscription parameters","MEDIUM",{subscription:e,reason:t})}static subscriptionLimitExceeded(e,t){return new r("DATA_SUBSCRIPTION_LIMIT",`Subscription limit exceeded (${e}/${t})`,"HIGH",{currentCount:e,maxLimit:t})}static validationFailed(e,t){return new r("DATA_VALIDATION_FAILED","Data validation failed","MEDIUM",{data:e,validationErrors:t})}static sequenceError(e,t,n){return new r("DATA_SEQUENCE_ERROR",`Message sequence error: expected ${e}, received ${t}`,"MEDIUM",{expected:e,received:t,...n})}static transformError(e,t,n){return new r("DATA_TRANSFORM_ERROR","Failed to transform data","MEDIUM",{data:e,targetFormat:t},n)}static schemaError(e,t,n){return new r("DATA_SCHEMA_ERROR","Data does not match schema","HIGH",{data:e,schema:t},n)}static stalePriceError(e,t,n){return new r("DATA_STALE_PRICE",`Price data for ${e} is stale`,"HIGH",{symbol:e,lastUpdateTime:t,maxAge:n,currentTime:Date.now()})}static chainError(e,t,n){return new r("DATA_CHAIN_ERROR",`Chain-specific error on ${e} during ${t}`,"HIGH",{chain:e,operation:t},n)}};var I;(function(r){r.assertEqual=a=>a;function e(a){}r.assertIs=e;function t(a){throw new Error}r.assertNever=t,r.arrayToEnum=a=>{let s={};for(let i of a)s[i]=i;return s},r.getValidEnumValues=a=>{let s=r.objectKeys(a).filter(o=>typeof a[a[o]]!="number"),i={};for(let o of s)i[o]=a[o];return r.objectValues(i)},r.objectValues=a=>r.objectKeys(a).map(function(s){return a[s]}),r.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{let s=[];for(let i in a)Object.prototype.hasOwnProperty.call(a,i)&&s.push(i);return s},r.find=(a,s)=>{for(let i of a)if(s(i))return i},r.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&isFinite(a)&&Math.floor(a)===a;function n(a,s=" | "){return a.map(i=>typeof i=="string"?`'${i}'`:i).join(s)}r.joinValues=n,r.jsonStringifyReplacer=(a,s)=>typeof s=="bigint"?s.toString():s;})(I||(I={}));var Ue;(function(r){r.mergeShapes=(e,t)=>({...e,...t});})(Ue||(Ue={}));var f=I.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),B=r=>{switch(typeof r){case "undefined":return f.undefined;case "string":return f.string;case "number":return isNaN(r)?f.nan:f.number;case "boolean":return f.boolean;case "function":return f.function;case "bigint":return f.bigint;case "symbol":return f.symbol;case "object":return Array.isArray(r)?f.array:r===null?f.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?f.promise:typeof Map<"u"&&r instanceof Map?f.map:typeof Set<"u"&&r instanceof Set?f.set:typeof Date<"u"&&r instanceof Date?f.date:f.object;default:return f.unknown}},d=I.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),wt=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),O=class r extends Error{constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n];},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n];};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e;}get errors(){return this.issues}format(e){let t=e||function(s){return s.message},n={_errors:[]},a=s=>{for(let i of s.issues)if(i.code==="invalid_union")i.unionErrors.map(a);else if(i.code==="invalid_return_type")a(i.returnTypeError);else if(i.code==="invalid_arguments")a(i.argumentsError);else if(i.path.length===0)n._errors.push(t(i));else {let o=n,c=0;for(;c<i.path.length;){let l=i.path[c];c===i.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(i))):o[l]=o[l]||{_errors:[]},o=o[l],c++;}}};return a(this),n}static assert(e){if(!(e instanceof r))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,I.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},n=[];for(let a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):n.push(e(a));return {formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};O.create=r=>new O(r);var he=(r,e)=>{let t;switch(r.code){case d.invalid_type:r.received===f.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case d.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,I.jsonStringifyReplacer)}`;break;case d.unrecognized_keys:t=`Unrecognized key(s) in object: ${I.joinValues(r.keys,", ")}`;break;case d.invalid_union:t="Invalid input";break;case d.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${I.joinValues(r.options)}`;break;case d.invalid_enum_value:t=`Invalid enum value. Expected ${I.joinValues(r.options)}, received '${r.received}'`;break;case d.invalid_arguments:t="Invalid function arguments";break;case d.invalid_return_type:t="Invalid function return type";break;case d.invalid_date:t="Invalid date";break;case d.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:I.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case d.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case d.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case d.custom:t="Invalid input";break;case d.invalid_intersection_types:t="Intersection results could not be merged";break;case d.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case d.not_finite:t="Number must be finite";break;default:t=e.defaultError,I.assertNever(r);}return {message:t}},Xe=he;function Nt(r){Xe=r;}function Ce(){return Xe}var Oe=r=>{let{data:e,path:t,errorMaps:n,issueData:a}=r,s=[...t,...a.path||[]],i={...a,path:s};if(a.message!==undefined)return {...a,path:s,message:a.message};let o="",c=n.filter(l=>!!l).slice().reverse();for(let l of c)o=l(i,{data:e,defaultError:o}).message;return {...a,path:s,message:o}},Ct=[];function u(r,e){let t=Ce(),n=Oe({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===he?undefined:he].filter(a=>!!a)});r.common.issues.push(n);}var w=class r{constructor(){this.value="valid";}dirty(){this.value==="valid"&&(this.value="dirty");}abort(){this.value!=="aborted"&&(this.value="aborted");}static mergeArray(e,t){let n=[];for(let a of t){if(a.status==="aborted")return y;a.status==="dirty"&&e.dirty(),n.push(a.value);}return {status:e.value,value:n}}static async mergeObjectAsync(e,t){let n=[];for(let a of t){let s=await a.key,i=await a.value;n.push({key:s,value:i});}return r.mergeObjectSync(e,n)}static mergeObjectSync(e,t){let n={};for(let a of t){let{key:s,value:i}=a;if(s.status==="aborted"||i.status==="aborted")return y;s.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof i.value<"u"||a.alwaysSet)&&(n[s.value]=i.value);}return {status:e.value,value:n}}},y=Object.freeze({status:"aborted"}),me=r=>({status:"dirty",value:r}),N=r=>({status:"valid",value:r}),Ge=r=>r.status==="aborted",$e=r=>r.status==="dirty",Re=r=>r.status==="valid",Se=r=>typeof Promise<"u"&&r instanceof Promise;function Pe(r,e,t,n){if(typeof e=="function"?r!==e||true:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}function Je(r,e,t,n,a){if(typeof e=="function"?r!==e||true:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}var _;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message;})(_||(_={}));var Ie,Ae,L=class{constructor(e,t,n,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=a;}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},qe=(r,e)=>{if(Re(e))return {success:true,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return {success:false,get error(){if(this._error)return this._error;let t=new O(r.common.issues);return this._error=t,this._error}}};function E(r){if(!r)return {};let{errorMap:e,invalid_type_error:t,required_error:n,description:a}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(i,o)=>{var c,l;let{message:m}=r;return i.code==="invalid_enum_value"?{message:m??o.defaultError}:typeof o.data>"u"?{message:(c=m??n)!==null&&c!==undefined?c:o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:(l=m??t)!==null&&l!==undefined?l:o.defaultError}},description:a}}var v=class{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this);}get description(){return this._def.description}_getType(e){return B(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:B(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return {status:new w,ctx:{common:e.parent.common,data:e.data,parsedType:B(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(Se(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;let a={common:{issues:[],async:(n=t?.async)!==null&&n!==undefined?n:false,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:B(e)},s=this._parseSync({data:e,path:a.path,parent:a});return qe(a,s)}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:true},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:B(e)},a=this._parse({data:e,path:n.path,parent:n}),s=await(Se(a)?a:Promise.resolve(a));return qe(n,s)}refine(e,t){let n=a=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(a):t;return this._refinement((a,s)=>{let i=e(a),o=()=>s.addIssue({code:d.custom,...n(a)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?true:(o(),false)):i?true:(o(),false)})}refinement(e,t){return this._refinement((n,a)=>e(n)?true:(a.addIssue(typeof t=="function"?t(n,a):t),false))}_refinement(e){return new P({schema:this,typeName:g.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return D.create(this,this._def)}nullable(){return G.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Z.create(this,this._def)}promise(){return K.create(this,this._def)}or(e){return ae.create([this,e],this._def)}and(e){return se.create(this,e,this._def)}transform(e){return new P({...E(this._def),schema:this,typeName:g.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new le({...E(this._def),innerType:this,defaultValue:t,typeName:g.ZodDefault})}brand(){return new xe({typeName:g.ZodBranded,type:this,...E(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new ue({...E(this._def),innerType:this,catchValue:t,typeName:g.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return we.create(this,e)}readonly(){return pe.create(this)}isOptional(){return this.safeParse(undefined).success}isNullable(){return this.safeParse(null).success}},Ot=/^c[^\s-]{8,}$/i,Pt=/^[0-9a-z]+$/,kt=/^[0-9A-HJKMNP-TV-Z]{26}$/,Dt=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Lt=/^[a-z0-9_-]{21}$/i,Ht=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Mt=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Ut="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Me,Gt=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,$t=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Vt=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Qe="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",jt=new RegExp(`^${Qe}$`);function et(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Ft(r){return new RegExp(`^${et(r)}$`)}function tt(r){let e=`${Qe}T${et(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Yt(r,e){return !!((e==="v4"||!e)&&Gt.test(r)||(e==="v6"||!e)&&$t.test(r))}var z=class r extends v{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==f.string){let s=this._getOrReturnCtx(e);return u(s,{code:d.invalid_type,expected:f.string,received:s.parsedType}),y}let n=new w,a;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(a=this._getOrReturnCtx(e,a),u(a,{code:d.too_small,minimum:s.value,type:"string",inclusive:true,exact:false,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(a=this._getOrReturnCtx(e,a),u(a,{code:d.too_big,maximum:s.value,type:"string",inclusive:true,exact:false,message:s.message}),n.dirty());else if(s.kind==="length"){let i=e.data.length>s.value,o=e.data.length<s.value;(i||o)&&(a=this._getOrReturnCtx(e,a),i?u(a,{code:d.too_big,maximum:s.value,type:"string",inclusive:true,exact:true,message:s.message}):o&&u(a,{code:d.too_small,minimum:s.value,type:"string",inclusive:true,exact:true,message:s.message}),n.dirty());}else if(s.kind==="email")Mt.test(e.data)||(a=this._getOrReturnCtx(e,a),u(a,{validation:"email",code:d.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")Me||(Me=new RegExp(Ut,"u")),Me.test(e.data)||(a=this._getOrReturnCtx(e,a),u(a,{validation:"emoji",code:d.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")Dt.test(e.data)||(a=this._getOrReturnCtx(e,a),u(a,{validation:"uuid",code:d.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")Lt.test(e.data)||(a=this._getOrReturnCtx(e,a),u(a,{validation:"nanoid",code:d.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")Ot.test(e.data)||(a=this._getOrReturnCtx(e,a),u(a,{validation:"cuid",code:d.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")Pt.test(e.data)||(a=this._getOrReturnCtx(e,a),u(a,{validation:"cuid2",code:d.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")kt.test(e.data)||(a=this._getOrReturnCtx(e,a),u(a,{validation:"ulid",code:d.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data);}catch{a=this._getOrReturnCtx(e,a),u(a,{validation:"url",code:d.invalid_string,message:s.message}),n.dirty();}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),u(a,{validation:"regex",code:d.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(a=this._getOrReturnCtx(e,a),u(a,{code:d.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(a=this._getOrReturnCtx(e,a),u(a,{code:d.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(a=this._getOrReturnCtx(e,a),u(a,{code:d.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?tt(s).test(e.data)||(a=this._getOrReturnCtx(e,a),u(a,{code:d.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?jt.test(e.data)||(a=this._getOrReturnCtx(e,a),u(a,{code:d.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?Ft(s).test(e.data)||(a=this._getOrReturnCtx(e,a),u(a,{code:d.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?Ht.test(e.data)||(a=this._getOrReturnCtx(e,a),u(a,{validation:"duration",code:d.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?Yt(e.data,s.version)||(a=this._getOrReturnCtx(e,a),u(a,{validation:"ip",code:d.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?Vt.test(e.data)||(a=this._getOrReturnCtx(e,a),u(a,{validation:"base64",code:d.invalid_string,message:s.message}),n.dirty()):I.assertNever(s);return {status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(a=>e.test(a),{validation:t,code:d.invalid_string,..._.errToObj(n)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",..._.errToObj(e)})}url(e){return this._addCheck({kind:"url",..._.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",..._.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",..._.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",..._.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",..._.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",..._.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",..._.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",..._.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",..._.errToObj(e)})}datetime(e){var t,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:false,local:false,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(t=e?.offset)!==null&&t!==undefined?t:false,local:(n=e?.local)!==null&&n!==undefined?n:false,..._.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,..._.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",..._.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,..._.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,..._.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,..._.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,..._.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,..._.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,..._.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,..._.errToObj(t)})}nonempty(e){return this.min(1,_.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return !!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return !!this._def.checks.find(e=>e.kind==="date")}get isTime(){return !!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return !!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return !!this._def.checks.find(e=>e.kind==="email")}get isURL(){return !!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return !!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return !!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return !!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return !!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return !!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return !!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return !!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return !!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};z.create=r=>{var e;return new z({checks:[],typeName:g.ZodString,coerce:(e=r?.coerce)!==null&&e!==undefined?e:false,...E(r)})};function Zt(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,a=t>n?t:n,s=parseInt(r.toFixed(a).replace(".","")),i=parseInt(e.toFixed(a).replace(".",""));return s%i/Math.pow(10,a)}var J=class r extends v{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf;}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==f.number){let s=this._getOrReturnCtx(e);return u(s,{code:d.invalid_type,expected:f.number,received:s.parsedType}),y}let n,a=new w;for(let s of this._def.checks)s.kind==="int"?I.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),u(n,{code:d.invalid_type,expected:"integer",received:"float",message:s.message}),a.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),u(n,{code:d.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:false,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),u(n,{code:d.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:false,message:s.message}),a.dirty()):s.kind==="multipleOf"?Zt(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),u(n,{code:d.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),u(n,{code:d.not_finite,message:s.message}),a.dirty()):I.assertNever(s);return {status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,true,_.toString(t))}gt(e,t){return this.setLimit("min",e,false,_.toString(t))}lte(e,t){return this.setLimit("max",e,true,_.toString(t))}lt(e,t){return this.setLimit("max",e,false,_.toString(t))}setLimit(e,t,n,a){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:_.toString(a)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:_.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:false,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:false,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:true,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:true,message:_.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:_.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:true,value:Number.MIN_SAFE_INTEGER,message:_.toString(e)})._addCheck({kind:"max",inclusive:true,value:Number.MAX_SAFE_INTEGER,message:_.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return !!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&I.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return  true;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);}return Number.isFinite(t)&&Number.isFinite(e)}};J.create=r=>new J({checks:[],typeName:g.ZodNumber,coerce:r?.coerce||false,...E(r)});var Q=class r extends v{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte;}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==f.bigint){let s=this._getOrReturnCtx(e);return u(s,{code:d.invalid_type,expected:f.bigint,received:s.parsedType}),y}let n,a=new w;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),u(n,{code:d.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),u(n,{code:d.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),u(n,{code:d.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):I.assertNever(s);return {status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,true,_.toString(t))}gt(e,t){return this.setLimit("min",e,false,_.toString(t))}lte(e,t){return this.setLimit("max",e,true,_.toString(t))}lt(e,t){return this.setLimit("max",e,false,_.toString(t))}setLimit(e,t,n,a){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:_.toString(a)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:false,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:false,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:true,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:true,message:_.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Q.create=r=>{var e;return new Q({checks:[],typeName:g.ZodBigInt,coerce:(e=r?.coerce)!==null&&e!==undefined?e:false,...E(r)})};var ee=class extends v{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==f.boolean){let n=this._getOrReturnCtx(e);return u(n,{code:d.invalid_type,expected:f.boolean,received:n.parsedType}),y}return N(e.data)}};ee.create=r=>new ee({typeName:g.ZodBoolean,coerce:r?.coerce||false,...E(r)});var te=class r extends v{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==f.date){let s=this._getOrReturnCtx(e);return u(s,{code:d.invalid_type,expected:f.date,received:s.parsedType}),y}if(isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return u(s,{code:d.invalid_date}),y}let n=new w,a;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(a=this._getOrReturnCtx(e,a),u(a,{code:d.too_small,message:s.message,inclusive:true,exact:false,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(a=this._getOrReturnCtx(e,a),u(a,{code:d.too_big,message:s.message,inclusive:true,exact:false,maximum:s.value,type:"date"}),n.dirty()):I.assertNever(s);return {status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:_.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:_.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};te.create=r=>new te({checks:[],coerce:r?.coerce||false,typeName:g.ZodDate,...E(r)});var _e=class extends v{_parse(e){if(this._getType(e)!==f.symbol){let n=this._getOrReturnCtx(e);return u(n,{code:d.invalid_type,expected:f.symbol,received:n.parsedType}),y}return N(e.data)}};_e.create=r=>new _e({typeName:g.ZodSymbol,...E(r)});var re=class extends v{_parse(e){if(this._getType(e)!==f.undefined){let n=this._getOrReturnCtx(e);return u(n,{code:d.invalid_type,expected:f.undefined,received:n.parsedType}),y}return N(e.data)}};re.create=r=>new re({typeName:g.ZodUndefined,...E(r)});var ne=class extends v{_parse(e){if(this._getType(e)!==f.null){let n=this._getOrReturnCtx(e);return u(n,{code:d.invalid_type,expected:f.null,received:n.parsedType}),y}return N(e.data)}};ne.create=r=>new ne({typeName:g.ZodNull,...E(r)});var q=class extends v{constructor(){super(...arguments),this._any=true;}_parse(e){return N(e.data)}};q.create=r=>new q({typeName:g.ZodAny,...E(r)});var Y=class extends v{constructor(){super(...arguments),this._unknown=true;}_parse(e){return N(e.data)}};Y.create=r=>new Y({typeName:g.ZodUnknown,...E(r)});var M=class extends v{_parse(e){let t=this._getOrReturnCtx(e);return u(t,{code:d.invalid_type,expected:f.never,received:t.parsedType}),y}};M.create=r=>new M({typeName:g.ZodNever,...E(r)});var ge=class extends v{_parse(e){if(this._getType(e)!==f.undefined){let n=this._getOrReturnCtx(e);return u(n,{code:d.invalid_type,expected:f.void,received:n.parsedType}),y}return N(e.data)}};ge.create=r=>new ge({typeName:g.ZodVoid,...E(r)});var Z=class r extends v{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),a=this._def;if(t.parsedType!==f.array)return u(t,{code:d.invalid_type,expected:f.array,received:t.parsedType}),y;if(a.exactLength!==null){let i=t.data.length>a.exactLength.value,o=t.data.length<a.exactLength.value;(i||o)&&(u(t,{code:i?d.too_big:d.too_small,minimum:o?a.exactLength.value:undefined,maximum:i?a.exactLength.value:undefined,type:"array",inclusive:true,exact:true,message:a.exactLength.message}),n.dirty());}if(a.minLength!==null&&t.data.length<a.minLength.value&&(u(t,{code:d.too_small,minimum:a.minLength.value,type:"array",inclusive:true,exact:false,message:a.minLength.message}),n.dirty()),a.maxLength!==null&&t.data.length>a.maxLength.value&&(u(t,{code:d.too_big,maximum:a.maxLength.value,type:"array",inclusive:true,exact:false,message:a.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>a.type._parseAsync(new L(t,i,t.path,o)))).then(i=>w.mergeArray(n,i));let s=[...t.data].map((i,o)=>a.type._parseSync(new L(t,i,t.path,o)));return w.mergeArray(n,s)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:_.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:_.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:_.toString(t)}})}nonempty(e){return this.min(1,e)}};Z.create=(r,e)=>new Z({type:r,minLength:null,maxLength:null,exactLength:null,typeName:g.ZodArray,...E(e)});function fe(r){if(r instanceof C){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=D.create(fe(n));}return new C({...r._def,shape:()=>e})}else return r instanceof Z?new Z({...r._def,type:fe(r.element)}):r instanceof D?D.create(fe(r.unwrap())):r instanceof G?G.create(fe(r.unwrap())):r instanceof U?U.create(r.items.map(e=>fe(e))):r}var C=class r extends v{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend;}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=I.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==f.object){let l=this._getOrReturnCtx(e);return u(l,{code:d.invalid_type,expected:f.object,received:l.parsedType}),y}let{status:n,ctx:a}=this._processInputParams(e),{shape:s,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof M&&this._def.unknownKeys==="strip"))for(let l in a.data)i.includes(l)||o.push(l);let c=[];for(let l of i){let m=s[l],T=a.data[l];c.push({key:{status:"valid",value:l},value:m._parse(new L(a,T,a.path,l)),alwaysSet:l in a.data});}if(this._def.catchall instanceof M){let l=this._def.unknownKeys;if(l==="passthrough")for(let m of o)c.push({key:{status:"valid",value:m},value:{status:"valid",value:a.data[m]}});else if(l==="strict")o.length>0&&(u(a,{code:d.unrecognized_keys,keys:o}),n.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else {let l=this._def.catchall;for(let m of o){let T=a.data[m];c.push({key:{status:"valid",value:m},value:l._parse(new L(a,T,a.path,m)),alwaysSet:m in a.data});}}return a.common.async?Promise.resolve().then(async()=>{let l=[];for(let m of c){let T=await m.key,S=await m.value;l.push({key:T,value:S,alwaysSet:m.alwaysSet});}return l}).then(l=>w.mergeObjectSync(n,l)):w.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return _.errToObj,new r({...this._def,unknownKeys:"strict",...e!==undefined?{errorMap:(t,n)=>{var a,s,i,o;let c=(i=(s=(a=this._def).errorMap)===null||s===undefined?undefined:s.call(a,t,n).message)!==null&&i!==undefined?i:n.defaultError;return t.code==="unrecognized_keys"?{message:(o=_.errToObj(e).message)!==null&&o!==undefined?o:c}:{message:c}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:g.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};return I.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n]);}),new r({...this._def,shape:()=>t})}omit(e){let t={};return I.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n]);}),new r({...this._def,shape:()=>t})}deepPartial(){return fe(this)}partial(e){let t={};return I.objectKeys(this.shape).forEach(n=>{let a=this.shape[n];e&&!e[n]?t[n]=a:t[n]=a.optional();}),new r({...this._def,shape:()=>t})}required(e){let t={};return I.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else {let s=this.shape[n];for(;s instanceof D;)s=s._def.innerType;t[n]=s;}}),new r({...this._def,shape:()=>t})}keyof(){return rt(I.objectKeys(this.shape))}};C.create=(r,e)=>new C({shape:()=>r,unknownKeys:"strip",catchall:M.create(),typeName:g.ZodObject,...E(e)});C.strictCreate=(r,e)=>new C({shape:()=>r,unknownKeys:"strict",catchall:M.create(),typeName:g.ZodObject,...E(e)});C.lazycreate=(r,e)=>new C({shape:r,unknownKeys:"strip",catchall:M.create(),typeName:g.ZodObject,...E(e)});var ae=class extends v{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function a(s){for(let o of s)if(o.result.status==="valid")return o.result;for(let o of s)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;let i=s.map(o=>new O(o.ctx.common.issues));return u(t,{code:d.invalid_union,unionErrors:i}),y}if(t.common.async)return Promise.all(n.map(async s=>{let i={...t,common:{...t.common,issues:[]},parent:null};return {result:await s._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(a);{let s,i=[];for(let c of n){let l={...t,common:{...t.common,issues:[]},parent:null},m=c._parseSync({data:t.data,path:t.path,parent:l});if(m.status==="valid")return m;m.status==="dirty"&&!s&&(s={result:m,ctx:l}),l.common.issues.length&&i.push(l.common.issues);}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;let o=i.map(c=>new O(c));return u(t,{code:d.invalid_union,unionErrors:o}),y}}get options(){return this._def.options}};ae.create=(r,e)=>new ae({options:r,typeName:g.ZodUnion,...E(e)});var F=r=>r instanceof ie?F(r.schema):r instanceof P?F(r.innerType()):r instanceof oe?[r.value]:r instanceof ce?r.options:r instanceof de?I.objectValues(r.enum):r instanceof le?F(r._def.innerType):r instanceof re?[undefined]:r instanceof ne?[null]:r instanceof D?[undefined,...F(r.unwrap())]:r instanceof G?[null,...F(r.unwrap())]:r instanceof xe||r instanceof pe?F(r.unwrap()):r instanceof ue?F(r._def.innerType):[],ke=class r extends v{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==f.object)return u(t,{code:d.invalid_type,expected:f.object,received:t.parsedType}),y;let n=this.discriminator,a=t.data[n],s=this.optionsMap.get(a);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(u(t,{code:d.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),y)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let a=new Map;for(let s of t){let i=F(s.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of i){if(a.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);a.set(o,s);}}return new r({typeName:g.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...E(n)})}};function Ve(r,e){let t=B(r),n=B(e);if(r===e)return {valid:true,data:r};if(t===f.object&&n===f.object){let a=I.objectKeys(e),s=I.objectKeys(r).filter(o=>a.indexOf(o)!==-1),i={...r,...e};for(let o of s){let c=Ve(r[o],e[o]);if(!c.valid)return {valid:false};i[o]=c.data;}return {valid:true,data:i}}else if(t===f.array&&n===f.array){if(r.length!==e.length)return {valid:false};let a=[];for(let s=0;s<r.length;s++){let i=r[s],o=e[s],c=Ve(i,o);if(!c.valid)return {valid:false};a.push(c.data);}return {valid:true,data:a}}else return t===f.date&&n===f.date&&+r==+e?{valid:true,data:r}:{valid:false}}var se=class extends v{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),a=(s,i)=>{if(Ge(s)||Ge(i))return y;let o=Ve(s.value,i.value);return o.valid?(($e(s)||$e(i))&&t.dirty(),{status:t.value,value:o.data}):(u(n,{code:d.invalid_intersection_types}),y)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,i])=>a(s,i)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};se.create=(r,e,t)=>new se({left:r,right:e,typeName:g.ZodIntersection,...E(t)});var U=class r extends v{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==f.array)return u(n,{code:d.invalid_type,expected:f.array,received:n.parsedType}),y;if(n.data.length<this._def.items.length)return u(n,{code:d.too_small,minimum:this._def.items.length,inclusive:true,exact:false,type:"array"}),y;!this._def.rest&&n.data.length>this._def.items.length&&(u(n,{code:d.too_big,maximum:this._def.items.length,inclusive:true,exact:false,type:"array"}),t.dirty());let s=[...n.data].map((i,o)=>{let c=this._def.items[o]||this._def.rest;return c?c._parse(new L(n,i,n.path,o)):null}).filter(i=>!!i);return n.common.async?Promise.all(s).then(i=>w.mergeArray(t,i)):w.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};U.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new U({items:r,typeName:g.ZodTuple,rest:null,...E(e)})};var De=class r extends v{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==f.object)return u(n,{code:d.invalid_type,expected:f.object,received:n.parsedType}),y;let a=[],s=this._def.keyType,i=this._def.valueType;for(let o in n.data)a.push({key:s._parse(new L(n,o,n.path,o)),value:i._parse(new L(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?w.mergeObjectAsync(t,a):w.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof v?new r({keyType:e,valueType:t,typeName:g.ZodRecord,...E(n)}):new r({keyType:z.create(),valueType:e,typeName:g.ZodRecord,...E(t)})}},ye=class extends v{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==f.map)return u(n,{code:d.invalid_type,expected:f.map,received:n.parsedType}),y;let a=this._def.keyType,s=this._def.valueType,i=[...n.data.entries()].map(([o,c],l)=>({key:a._parse(new L(n,o,n.path,[l,"key"])),value:s._parse(new L(n,c,n.path,[l,"value"]))}));if(n.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let c of i){let l=await c.key,m=await c.value;if(l.status==="aborted"||m.status==="aborted")return y;(l.status==="dirty"||m.status==="dirty")&&t.dirty(),o.set(l.value,m.value);}return {status:t.value,value:o}})}else {let o=new Map;for(let c of i){let l=c.key,m=c.value;if(l.status==="aborted"||m.status==="aborted")return y;(l.status==="dirty"||m.status==="dirty")&&t.dirty(),o.set(l.value,m.value);}return {status:t.value,value:o}}}};ye.create=(r,e,t)=>new ye({valueType:e,keyType:r,typeName:g.ZodMap,...E(t)});var Ee=class r extends v{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==f.set)return u(n,{code:d.invalid_type,expected:f.set,received:n.parsedType}),y;let a=this._def;a.minSize!==null&&n.data.size<a.minSize.value&&(u(n,{code:d.too_small,minimum:a.minSize.value,type:"set",inclusive:true,exact:false,message:a.minSize.message}),t.dirty()),a.maxSize!==null&&n.data.size>a.maxSize.value&&(u(n,{code:d.too_big,maximum:a.maxSize.value,type:"set",inclusive:true,exact:false,message:a.maxSize.message}),t.dirty());let s=this._def.valueType;function i(c){let l=new Set;for(let m of c){if(m.status==="aborted")return y;m.status==="dirty"&&t.dirty(),l.add(m.value);}return {status:t.value,value:l}}let o=[...n.data.values()].map((c,l)=>s._parse(new L(n,c,n.path,l)));return n.common.async?Promise.all(o).then(c=>i(c)):i(o)}min(e,t){return new r({...this._def,minSize:{value:e,message:_.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:_.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Ee.create=(r,e)=>new Ee({valueType:r,minSize:null,maxSize:null,typeName:g.ZodSet,...E(e)});var Le=class r extends v{constructor(){super(...arguments),this.validate=this.implement;}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==f.function)return u(t,{code:d.invalid_type,expected:f.function,received:t.parsedType}),y;function n(o,c){return Oe({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ce(),he].filter(l=>!!l),issueData:{code:d.invalid_arguments,argumentsError:c}})}function a(o,c){return Oe({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ce(),he].filter(l=>!!l),issueData:{code:d.invalid_return_type,returnTypeError:c}})}let s={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof K){let o=this;return N(async function(...c){let l=new O([]),m=await o._def.args.parseAsync(c,s).catch(b=>{throw l.addIssue(n(c,b)),l}),T=await Reflect.apply(i,this,m);return await o._def.returns._def.type.parseAsync(T,s).catch(b=>{throw l.addIssue(a(T,b)),l})})}else {let o=this;return N(function(...c){let l=o._def.args.safeParse(c,s);if(!l.success)throw new O([n(c,l.error)]);let m=Reflect.apply(i,this,l.data),T=o._def.returns.safeParse(m,s);if(!T.success)throw new O([a(m,T.error)]);return T.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:U.create(e).rest(Y.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new r({args:e||U.create([]).rest(Y.create()),returns:t||Y.create(),typeName:g.ZodFunction,...E(n)})}},ie=class extends v{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};ie.create=(r,e)=>new ie({getter:r,typeName:g.ZodLazy,...E(e)});var oe=class extends v{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return u(t,{received:t.data,code:d.invalid_literal,expected:this._def.value}),y}return {status:"valid",value:e.data}}get value(){return this._def.value}};oe.create=(r,e)=>new oe({value:r,typeName:g.ZodLiteral,...E(e)});function rt(r,e){return new ce({values:r,typeName:g.ZodEnum,...E(e)})}var ce=class r extends v{constructor(){super(...arguments),Ie.set(this,undefined);}_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),n=this._def.values;return u(t,{expected:I.joinValues(n),received:t.parsedType,code:d.invalid_type}),y}if(Pe(this,Ie)||Je(this,Ie,new Set(this._def.values)),!Pe(this,Ie).has(e.data)){let t=this._getOrReturnCtx(e),n=this._def.values;return u(t,{received:t.data,code:d.invalid_enum_value,options:n}),y}return N(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r.create(e,{...this._def,...t})}exclude(e,t=this._def){return r.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}};Ie=new WeakMap;ce.create=rt;var de=class extends v{constructor(){super(...arguments),Ae.set(this,undefined);}_parse(e){let t=I.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==f.string&&n.parsedType!==f.number){let a=I.objectValues(t);return u(n,{expected:I.joinValues(a),received:n.parsedType,code:d.invalid_type}),y}if(Pe(this,Ae)||Je(this,Ae,new Set(I.getValidEnumValues(this._def.values))),!Pe(this,Ae).has(e.data)){let a=I.objectValues(t);return u(n,{received:n.data,code:d.invalid_enum_value,options:a}),y}return N(e.data)}get enum(){return this._def.values}};Ae=new WeakMap;de.create=(r,e)=>new de({values:r,typeName:g.ZodNativeEnum,...E(e)});var K=class extends v{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==f.promise&&t.common.async===false)return u(t,{code:d.invalid_type,expected:f.promise,received:t.parsedType}),y;let n=t.parsedType===f.promise?t.data:Promise.resolve(t.data);return N(n.then(a=>this._def.type.parseAsync(a,{path:t.path,errorMap:t.common.contextualErrorMap})))}};K.create=(r,e)=>new K({type:r,typeName:g.ZodPromise,...E(e)});var P=class extends v{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===g.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),a=this._def.effect||null,s={addIssue:i=>{u(n,i),i.fatal?t.abort():t.dirty();},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),a.type==="preprocess"){let i=a.transform(n.data,s);if(n.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return y;let c=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return c.status==="aborted"?y:c.status==="dirty"||t.value==="dirty"?me(c.value):c});{if(t.value==="aborted")return y;let o=this._def.schema._parseSync({data:i,path:n.path,parent:n});return o.status==="aborted"?y:o.status==="dirty"||t.value==="dirty"?me(o.value):o}}if(a.type==="refinement"){let i=o=>{let c=a.refinement(o,s);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===false){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?y:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?y:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(a.type==="transform")if(n.common.async===false){let i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Re(i))return i;let o=a.transform(i.value,s);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return {status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>Re(i)?Promise.resolve(a.transform(i.value,s)).then(o=>({status:t.value,value:o})):i);I.assertNever(a);}};P.create=(r,e,t)=>new P({schema:r,typeName:g.ZodEffects,effect:e,...E(t)});P.createWithPreprocess=(r,e,t)=>new P({schema:e,effect:{type:"preprocess",transform:r},typeName:g.ZodEffects,...E(t)});var D=class extends v{_parse(e){return this._getType(e)===f.undefined?N(undefined):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};D.create=(r,e)=>new D({innerType:r,typeName:g.ZodOptional,...E(e)});var G=class extends v{_parse(e){return this._getType(e)===f.null?N(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};G.create=(r,e)=>new G({innerType:r,typeName:g.ZodNullable,...E(e)});var le=class extends v{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===f.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};le.create=(r,e)=>new le({innerType:r,typeName:g.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...E(e)});var ue=class extends v{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Se(a)?a.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new O(n.common.issues)},input:n.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new O(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};ue.create=(r,e)=>new ue({innerType:r,typeName:g.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...E(e)});var ve=class extends v{_parse(e){if(this._getType(e)!==f.nan){let n=this._getOrReturnCtx(e);return u(n,{code:d.invalid_type,expected:f.nan,received:n.parsedType}),y}return {status:"valid",value:e.data}}};ve.create=r=>new ve({typeName:g.ZodNaN,...E(r)});var Wt=Symbol("zod_brand"),xe=class extends v{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},we=class r extends v{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return (async()=>{let s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?y:s.status==="dirty"?(t.dirty(),me(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{let a=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?y:a.status==="dirty"?(t.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:n.path,parent:n})}}static create(e,t){return new r({in:e,out:t,typeName:g.ZodPipeline})}},pe=class extends v{_parse(e){let t=this._def.innerType._parse(e),n=a=>(Re(a)&&(a.value=Object.freeze(a.value)),a);return Se(t)?t.then(a=>n(a)):n(t)}unwrap(){return this._def.innerType}};pe.create=(r,e)=>new pe({innerType:r,typeName:g.ZodReadonly,...E(e)});function nt(r,e={},t){return r?q.create().superRefine((n,a)=>{var s,i;if(!r(n)){let o=typeof e=="function"?e(n):typeof e=="string"?{message:e}:e,c=(i=(s=o.fatal)!==null&&s!==undefined?s:t)!==null&&i!==undefined?i:true,l=typeof o=="string"?{message:o}:o;a.addIssue({code:"custom",...l,fatal:c});}}):q.create()}var Bt={object:C.lazycreate},g;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly";})(g||(g={}));var zt=(r,e={message:`Input not instance of ${r.name}`})=>nt(t=>t instanceof r,e),at=z.create,st=J.create,qt=ve.create,Kt=Q.create,it=ee.create,Xt=te.create,Jt=_e.create,Qt=re.create,er=ne.create,tr=q.create,rr=Y.create,nr=M.create,ar=ge.create,sr=Z.create,ir=C.create,or=C.strictCreate,cr=ae.create,dr=ke.create,lr=se.create,ur=U.create,pr=De.create,fr=ye.create,mr=Ee.create,hr=Le.create,_r=ie.create,gr=oe.create,yr=ce.create,Er=de.create,vr=K.create,Ke=P.create,Tr=D.create,br=G.create,Ir=P.createWithPreprocess,Ar=we.create,Rr=()=>at().optional(),Sr=()=>st().optional(),xr=()=>it().optional(),wr={string:r=>z.create({...r,coerce:true}),number:r=>J.create({...r,coerce:true}),boolean:r=>ee.create({...r,coerce:true}),bigint:r=>Q.create({...r,coerce:true}),date:r=>te.create({...r,coerce:true})},Nr=y,p=Object.freeze({__proto__:null,defaultErrorMap:he,setErrorMap:Nt,getErrorMap:Ce,makeIssue:Oe,EMPTY_PATH:Ct,addIssueToContext:u,ParseStatus:w,INVALID:y,DIRTY:me,OK:N,isAborted:Ge,isDirty:$e,isValid:Re,isAsync:Se,get util(){return I},get objectUtil(){return Ue},ZodParsedType:f,getParsedType:B,ZodType:v,datetimeRegex:tt,ZodString:z,ZodNumber:J,ZodBigInt:Q,ZodBoolean:ee,ZodDate:te,ZodSymbol:_e,ZodUndefined:re,ZodNull:ne,ZodAny:q,ZodUnknown:Y,ZodNever:M,ZodVoid:ge,ZodArray:Z,ZodObject:C,ZodUnion:ae,ZodDiscriminatedUnion:ke,ZodIntersection:se,ZodTuple:U,ZodRecord:De,ZodMap:ye,ZodSet:Ee,ZodFunction:Le,ZodLazy:ie,ZodLiteral:oe,ZodEnum:ce,ZodNativeEnum:de,ZodPromise:K,ZodEffects:P,ZodTransformer:P,ZodOptional:D,ZodNullable:G,ZodDefault:le,ZodCatch:ue,ZodNaN:ve,BRAND:Wt,ZodBranded:xe,ZodPipeline:we,ZodReadonly:pe,custom:nt,Schema:v,ZodSchema:v,late:Bt,get ZodFirstPartyTypeKind(){return g},coerce:wr,any:tr,array:sr,bigint:Kt,boolean:it,date:Xt,discriminatedUnion:dr,effect:Ke,enum:yr,function:hr,instanceof:zt,intersection:lr,lazy:_r,literal:gr,map:fr,nan:qt,nativeEnum:Er,never:nr,null:er,nullable:br,number:st,object:ir,oboolean:xr,onumber:Sr,optional:Tr,ostring:Rr,pipeline:Ar,preprocess:Ir,promise:vr,record:pr,set:mr,strictObject:or,string:at,symbol:Jt,transformer:Ke,tuple:ur,undefined:Qt,union:cr,unknown:rr,void:ar,NEVER:Nr,ZodIssueCode:d,quotelessJson:wt,ZodError:O});var je="mainnet",Cr={mainnet:{hermes:process.env.PYTH_MAINNET_HERMES_URL||"https://hermes.pyth.network",wss:process.env.PYTH_MAINNET_WSS_URL||"wss://hermes.pyth.network/ws",pythnet:process.env.PYTH_MAINNET_PYTHNET_URL||"https://pythnet.rpcpool.com",contractRegistry:process.env.PYTH_MAINNET_CONTRACT_REGISTRY||"https://pyth.network/developers/price-feed-ids",programKey:process.env.PYTH_MAINNET_PROGRAM_KEY||"FsJ3A3u2vn5cTVofAjvy6y5kwABJAqYWpe4975bi2epH"},testnet:{hermes:process.env.PYTH_TESTNET_HERMES_URL||"https://hermes.pyth.network",wss:process.env.PYTH_TESTNET_WSS_URL||"wss://hermes.pyth.network/ws",pythnet:process.env.PYTH_TESTNET_PYTHNET_URL||"https://pythnet.rpcpool.com",contractRegistry:process.env.PYTH_TESTNET_CONTRACT_REGISTRY||"https://pyth.network/developers/price-feed-ids#testnet",programKey:process.env.PYTH_TESTNET_PROGRAM_KEY||"FsJ3A3u2vn5cTVofAjvy6y5kwABJAqYWpe4975bi2epH"}},Or=p.object({PYTH_NETWORK_ENV:p.enum(["mainnet","testnet"]).default("mainnet"),PYTH_MAX_RETRIES:p.string().transform(Number).default("3"),PYTH_RETRY_DELAY:p.string().transform(Number).default("1000"),PYTH_TIMEOUT:p.string().transform(Number).default("5000"),PYTH_GRANULAR_LOG:p.boolean().default(true),PYTH_LOG_LEVEL:p.enum(["error","warn","info","debug"]).default("info"),RUNTIME_CHECK_MODE:p.boolean().default(false),PYTH_ENABLE_PRICE_STREAMING:p.boolean().default(true),PYTH_MAX_PRICE_STREAMS:p.string().transform(Number).default("10"),PYTH_TEST_ID01:p.string().default("0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43"),PYTH_TEST_ID02:p.string().default("0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace")});function W(r=je||process.env.PYTH_NETWORK_ENV){return je=r||"mainnet",{PYTH_NETWORK_ENV:r||"mainnet",PYTH_MAX_RETRIES:Number(process.env.PYTH_MAX_RETRIES||"3"),PYTH_RETRY_DELAY:Number(process.env.PYTH_RETRY_DELAY||"1000"),PYTH_TIMEOUT:Number(process.env.PYTH_TIMEOUT||"5000"),PYTH_GRANULAR_LOG:process.env.PYTH_GRANULAR_LOG==="true"||false,PYTH_LOG_LEVEL:process.env.PYTH_LOG_LEVEL||"info",RUNTIME_CHECK_MODE:process.env.RUNTIME_CHECK_MODE==="true"||false,PYTH_ENABLE_PRICE_STREAMING:process.env.PYTH_ENABLE_PRICE_STREAMING==="true"||true,PYTH_MAX_PRICE_STREAMS:Number(process.env.PYTH_MAX_PRICE_STREAMS||"10"),PYTH_TEST_ID01:process.env.PYTH_TEST_ID01||"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43",PYTH_TEST_ID02:process.env.PYTH_TEST_ID02||"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace"}}async function $(r){try{let e=W(r.getSetting("PYTH_NETWORK_ENV")??void 0),t={PYTH_NETWORK_ENV:process.env.PYTH_NETWORK_ENV||r.getSetting("PYTH_NETWORK_ENV")||e.PYTH_NETWORK_ENV,PYTH_MAX_RETRIES:process.env.PYTH_MAX_RETRIES||r.getSetting("PYTH_MAX_RETRIES")||e.PYTH_MAX_RETRIES.toString(),PYTH_RETRY_DELAY:process.env.PYTH_RETRY_DELAY||r.getSetting("PYTH_RETRY_DELAY")||e.PYTH_RETRY_DELAY.toString(),PYTH_GRANULAR_LOG:process.env.PYTH_GRANULAR_LOG==="true"||!1,PYTH_LOG_LEVEL:process.env.PYTH_LOG_LEVEL||r.getSetting("PYTH_LOG_LEVEL")||e.PYTH_LOG_LEVEL,RUNTIME_CHECK_MODE:process.env.RUNTIME_CHECK_MODE==="true"||!1,PYTH_ENABLE_PRICE_STREAMING:process.env.PYTH_ENABLE_PRICE_STREAMING==="true"||!0,PYTH_MAX_PRICE_STREAMS:process.env.PYTH_MAX_PRICE_STREAMS||r.getSetting("PYTH_MAX_PRICE_STREAMS")||e.PYTH_MAX_PRICE_STREAMS.toString(),PYTH_TEST_ID01:process.env.PYTH_TEST_ID01||e.PYTH_TEST_ID01,PYTH_TEST_ID02:process.env.PYTH_TEST_ID02||e.PYTH_TEST_ID02};return Or.parse(t)}catch(e){let t=e instanceof Error?e.message:String(e);throw new Error(`Failed to validate Pyth configuration: ${t}`)}}var X=(r=je)=>Cr[r];var Pr=p.object({asset_type:p.string(),base:p.string(),description:p.string(),display_symbol:p.string(),quote_currency:p.string(),schedule:p.string(),symbol:p.string(),generic_symbol:p.string().optional(),cms_symbol:p.string().optional(),country:p.string().optional(),cqs_symbol:p.string().optional(),nasdaq_symbol:p.string().optional(),contract_id:p.string().optional()}),kr=p.object({text:p.string(),query:p.string().optional(),filter:p.string().optional(),success:p.boolean().optional(),data:p.object({feeds:p.array(p.object({id:p.string(),attributes:Pr})),count:p.number(),responseType:p.string(),isArray:p.boolean(),error:p.string().optional()}).optional()});async function ct(r){try{let e=await kr.parseAsync(r);return elizaLogger.debug("Price feeds validation passed",{result:e}),!0}catch(e){throw elizaLogger.error("Price feeds validation failed",{error:e}),new h("DATA_VALIDATION_FAILED","Price feeds validation failed","HIGH",{error:e})}}var Lr=W(),Hr=Lr.PYTH_GRANULAR_LOG,x=(r,e)=>{Hr&&(elizaLogger.info(`[PriceFeeds] ${r}`,e),console.log(`[PriceFeeds] ${r}`,e?JSON.stringify(e,null,2):""));},Mr={name:"GET_PRICE_FEEDS",similes:["FETCH_PRICE_FEEDS","LIST_PRICE_FEEDS","QUERY_PRICE_FEEDS"],description:"Retrieve price feeds from Pyth Network matching specific criteria",examples:[[{user:"user",content:{text:"Get all available price feeds from Pyth Network",query:"BTC",filter:"USD"}},{user:"assistant",content:{text:"Price feeds matching query BTC and filter USD",success:true,query:"BTC",filter:"USD",data:{feeds:[{id:"f9c0172ba10dfa4d19088d94f5bf61d3b54d5bd7483a322a982e1373ee8ea31b",attributes:{asset_type:"Crypto",base:"BTC",description:"BITCOIN / US DOLLAR",display_symbol:"BTC/USD",generic_symbol:"BTCUSD",quote_currency:"USD",schedule:"America/New_York;O,O,O,O,O,O,O;",symbol:"Crypto.BTC/USD"}}]}}}]],async validate(r,e){if(e.content?.type!=="GET_PRICE_FEEDS")return  true;x("Starting validation",{messageId:e.id,content:e.content});try{let t=e.content;x("Validating content structure",{content:t});try{await ct(t),x("Schema validation passed");}catch(a){throw x("Schema validation error",{error:a}),a instanceof h?(elizaLogger.error("Schema validation failed",{errors:a.details?.errors}),a):new h("DATA_VALIDATION_FAILED","Schema validation failed","HIGH",{error:a})}let n=await $(r);if(x("Pyth config validation",{config:n}),!n)throw new h("DATA_VALIDATION_FAILED","Invalid Pyth configuration","HIGH");if(t.query&&typeof t.query!="string")throw x("Invalid query type",{query:t.query}),new h("DATA_VALIDATION_FAILED","Query must be a string","HIGH");if(t.filter&&typeof t.filter!="string")throw x("Invalid filter type",{filter:t.filter}),new h("DATA_VALIDATION_FAILED","Filter must be a string","HIGH");return x("Validation successful",{query:t.query,filter:t.filter}),!0}catch(t){throw x("Validation failed",{error:t instanceof Error?{message:t.message,stack:t.stack,name:t.name}:String(t)}),t instanceof h?t:new h("DATA_VALIDATION_FAILED","Invalid content format","HIGH",{content:e.content})}},async handler(r,e,t,n={},a){x("Starting handler execution",{messageId:e.id,hasCallback:!!a});try{let s=e.content,{query:i,filter:o}=s;x("Processing request",{query:i,filter:o});let c=await $(r);x("Got Pyth config",{networkEnv:c.PYTH_NETWORK_ENV});let l=X(c.PYTH_NETWORK_ENV);x("Network config",{networkConfig:l});let m=new HermesClient(l.hermes);x("Initialized HermesClient",{endpoint:l.hermes});let T={query:i,filter:o};x("Fetching price feeds with options",{options:T,hermesEndpoint:l.hermes,clientType:typeof m.getPriceFeeds});let S=await m.getPriceFeeds(T);x("Retrieved price feeds",{responseType:typeof S,isArray:Array.isArray(S),count:S?.length||0,sample:S?.slice(0,3)||[]});let b=S.map(R=>({id:R.id,attributes:{asset_type:R.attributes?.asset_type||"Unknown",base:R.attributes?.base||"Unknown",description:R.attributes?.description||"Unknown",display_symbol:R.attributes?.display_symbol||"Unknown",quote_currency:R.attributes?.quote_currency||"Unknown",schedule:R.attributes?.schedule||"",symbol:R.attributes?.symbol||"Unknown",generic_symbol:R.attributes?.generic_symbol,cms_symbol:R.attributes?.cms_symbol,country:R.attributes?.country,cqs_symbol:R.attributes?.cqs_symbol,nasdaq_symbol:R.attributes?.nasdaq_symbol,contract_id:R.attributes?.contract_id}})),Te={text:`Retrieved ${S.length} price feeds:
${b.map(R=>`- ${R.attributes.description} (${R.attributes.display_symbol})
  Type: ${R.attributes.asset_type}
  Base: ${R.attributes.base}
  Quote: ${R.attributes.quote_currency}
  Schedule: ${R.attributes.schedule}
  ID: ${R.id}`).join(`
`)}
${i?`
Matching query: "${i}"`:""}${o?`
With filter: "${o}"`:""}`,query:i,filter:o,success:!0,data:{feeds:b,count:S.length,responseType:"object",isArray:!0}};return x("Prepared callback content",{feedCount:b.length,firstFeed:b[0]}),a&&(x("Executing callback"),await a(Te),x("Callback completed")),!0}catch(s){let i=s instanceof Error?s.message:"Unknown error occurred",o=s instanceof Error?s.stack:undefined;x("Error retrieving price feeds",{error:i,stack:o});let c={text:`Failed to retrieve price feeds: ${i}
Error details: ${o||"No stack trace available"}`,success:false,data:{feeds:[],error:i,count:0,responseType:"object",isArray:true}};throw a&&await a(c),new h("PRICE_FEEDS_FETCH_FAILED",i,"HIGH")}}},lt=Mr;var Ur=p.object({encoding:p.enum(["hex","base64"]).optional(),parsed:p.boolean().optional(),allowUnordered:p.boolean().optional(),benchmarksOnly:p.boolean().optional()}),Gr=p.object({slot:p.number(),proof_available_time:p.number(),prev_publish_time:p.number()}),pt=p.object({price:p.string(),conf:p.string(),expo:p.number(),publish_time:p.number()}),$r=p.object({id:p.string(),price:pt,ema_price:pt,metadata:Gr.optional()}),Vr=p.object({encoding:p.string(),data:p.array(p.string())}),jr=p.object({text:p.string(),priceIds:p.array(p.string().regex(/^0x[0-9a-fA-F]{64}$/)),options:Ur.optional(),success:p.boolean().optional(),data:p.object({streamId:p.string(),status:p.enum(["connected","disconnected","error"]),binary:Vr.optional(),parsed:p.array($r).optional(),error:p.string().optional()}).optional()});async function ft(r){try{let e=await jr.parseAsync(r);return elizaLogger.debug("Price update stream validation passed",{result:e}),!0}catch(e){throw elizaLogger.error("Price update stream validation failed",{error:e}),new h("DATA_VALIDATION_FAILED","Price update stream validation failed","HIGH",{error:e})}}var _t=W(),Yr=_t.PYTH_GRANULAR_LOG,Ye=Number(_t.PYTH_MAX_PRICE_STREAMS),Fe=new Map,H=(r,e)=>{Yr&&(elizaLogger.info(`[PriceUpdatesStream] ${r}`,e),console.log(`[PriceUpdatesStream] ${r}`,e?JSON.stringify(e,null,2):""));};function mt(r){let e=[],t=r.match(/(?:BTC|ETH|SOL)\/USD/g);if(t){let n={"BTC/USD":"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43","ETH/USD":"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace","SOL/USD":"0xef0d8b6fda2ceba41da15d4095d1da392a0d2f8ed0c6c7bc0f4cfac8c280b56d"};e=t.map(a=>n[a]).filter(a=>a);}if(e.length===0){let n=r.match(/0x[0-9a-fA-F]{64}/g);if(n)e=n;else {let a=r.match(/[0-9a-fA-F]{64}/g);a&&(e=a.map(s=>`0x${s}`));}}return e}function Zr(r){return {binary:r.binary,parsed:r.parsed.map(e=>({id:e.id,price:{price:e.price.price,conf:e.price.conf,expo:e.price.expo,publish_time:e.price.publish_time},ema_price:{price:e.ema_price.price,conf:e.ema_price.conf,expo:e.ema_price.expo,publish_time:e.ema_price.publish_time},metadata:e.metadata?{slot:e.metadata.slot,proof_available_time:e.metadata.proof_available_time,prev_publish_time:e.metadata.prev_publish_time}:undefined}))}}function Wr(r,e,t){return `Price Update Stream (ID: stream_${r}, Update ${e}/${Ye}):
${t.parsed.map(n=>`Price Feed: ${n.id}
Current Price: ${(Number(n.price.price)*Math.pow(10,n.price.expo)).toFixed(2)} USD
Confidence: \xB1${(Number(n.price.conf)*Math.pow(10,n.price.expo)).toFixed(2)} USD
EMA Price: ${(Number(n.ema_price.price)*Math.pow(10,n.ema_price.expo)).toFixed(2)} USD
EMA Confidence: \xB1${(Number(n.ema_price.conf)*Math.pow(10,n.ema_price.expo)).toFixed(2)} USD
Last Update: ${new Date(n.price.publish_time*1e3).toLocaleString()}${n.metadata?`
Slot: ${n.metadata.slot}
Proof Available: ${new Date(n.metadata.proof_available_time*1e3).toLocaleString()}`:""}`).join(`

`)}`}async function Br(r,e){return new Promise((t,n)=>{let a=0,s={binary:{encoding:"hex",data:[]},parsed:[]};r.onmessage=i=>{a++,H("Received price update",{streamId:e,messageCount:a,data:i.data});try{let o=JSON.parse(i.data);s.binary.data.push(...o.binary.data),s.parsed.push(...o.parsed),a>=Ye&&(r.close(),t(s));}catch(o){r.close(),n(o);}},r.onerror=i=>{r.close(),n(i);};})}async function zr(r,e,t){let n=await $(r);if(!n)throw new h("DATA_VALIDATION_FAILED","Invalid Pyth configuration","HIGH");let a=X(n.PYTH_NETWORK_ENV),s=new HermesClient(a.hermes),i=`stream_${Date.now()}`;H("Creating price stream for IDs:",{streamId:i,priceIds:e});try{let o=await s.getPriceUpdatesStream(e,{parsed:!0,encoding:"hex"});Fe.set(i,o);try{let c=await Br(o,i),l=Zr(c),m=Wr(i,Ye,c);t&&t({text:m,success:!0,priceIds:e,data:{streamId:i,status:"connected",...l}}),Fe.delete(i),H("Stream completed successfully",{streamId:i});}catch(c){throw H("Error collecting stream data",{streamId:i,error:c}),t&&t({text:`Error processing price updates: ${c instanceof Error?c.message:String(c)}`,success:!1,priceIds:e,data:{streamId:i,status:"error",error:c instanceof Error?c.message:String(c)}}),Fe.delete(i),c}}catch(o){throw H("Error creating price stream",{streamId:i,error:o}),new h("DATA_TRANSFORM_ERROR",o instanceof Error?o.message:String(o),"HIGH")}}var qr={name:"GET_PRICE_UPDATES_STREAM",similes:["STREAM_PRICE_UPDATES","SUBSCRIBE_TO_PRICES","WATCH_PRICE_FEED"],description:"Create a streaming connection for real-time price updates from Pyth Network",examples:[[{user:"user",content:{text:"Stream BTC/USD price updates",priceIds:["0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43"],options:{encoding:"hex",parsed:true,benchmarksOnly:true}}},{user:"assistant",content:{text:"Starting BTC/USD price stream...",success:true,priceIds:["0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43"],data:{streamId:"stream_1",status:"connected",updates:[{id:"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43",price:42e3,confidence:100,timestamp:1641034800,emaPrice:41950}]}}}],[{user:"user",content:{text:"Stream ETH and BTC prices with benchmarks only",priceIds:["0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43","0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace"],options:{benchmarksOnly:true,parsed:true}}},{user:"assistant",content:{text:"Starting price stream for BTC and ETH...",success:true,priceIds:["0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43","0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace"],data:{streamId:"stream_2",status:"connected",updates:[{id:"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43",price:42e3,confidence:100,timestamp:1641034800,emaPrice:41950},{id:"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace",price:2500,confidence:50,timestamp:1641034800,emaPrice:2495}]}}}]],validate:async(r,e)=>{if(e.content?.type!=="GET_PRICE_UPDATES_STREAM")return  true;H("Starting validation",{content:e.content});try{let t=e.content;if(!t.priceIds){let a=mt(t.text);a.length>0&&(t={...t,priceIds:a,options:{parsed:!0,encoding:"hex"}},e.content=t);}try{await ft(t),H("Schema validation passed");}catch(a){throw H("Schema validation failed",{error:a}),a instanceof h?(elizaLogger.error("Schema validation failed",{errors:a.details?.errors}),a):new h("DATA_VALIDATION_FAILED","Schema validation failed","HIGH",{error:a})}if(!await $(r))throw new h("DATA_VALIDATION_FAILED","Invalid Pyth configuration","HIGH");if(!t.priceIds||!Array.isArray(t.priceIds))throw h.validationFailed(t,["priceIds must be an array of strings"]);if(t.priceIds.length===0)throw h.validationFailed(t,["priceIds array cannot be empty"]);if(t.priceIds.forEach((a,s)=>{if(!/^0x[0-9a-fA-F]{64}$/.test(a))throw h.validationFailed(t,[`Invalid price ID at index ${s}: ${a}`])}),t.options){let{encoding:a,parsed:s,allowUnordered:i,benchmarksOnly:o}=t.options;if(a&&!["hex","base64"].includes(a))throw h.validationFailed(t,["encoding must be either 'hex' or 'base64'"]);if(s!==void 0&&typeof s!="boolean")throw h.validationFailed(t,["parsed must be a boolean"]);if(i!==void 0&&typeof i!="boolean")throw h.validationFailed(t,["allowUnordered must be a boolean"]);if(o!==void 0&&typeof o!="boolean")throw h.validationFailed(t,["benchmarksOnly must be a boolean"])}return H("GET_PRICE_UPDATES_STREAM validation successful",{priceIds:t.priceIds,options:t.options}),!0}catch(t){throw H("Validation failed",{error:t}),t}},async handler(r,e,t,n={},a){H("Starting handler execution",{messageId:e.id,messageContent:e.content});try{let s=e.content,i=s.priceIds;if(!i&&(i=mt(s.text),i.length===0))throw new h("DATA_VALIDATION_FAILED","Could not extract any valid price IDs from message","HIGH");return await zr(r,i,a),!0}catch(s){throw H("Error in price updates stream handler",s),new h("DATA_TRANSFORM_ERROR",s instanceof Error?s.message:String(s),"HIGH")}}},gt=qr;var Xr=new Kr({allErrors:true,verbose:true,coerceTypes:true,useDefaults:true}),Jr={type:"object",required:["priceIds"],properties:{text:{type:"string"},priceIds:{type:"array",items:{type:"string",pattern:"^(0x)?[0-9a-fA-F]+$"},minItems:1,description:"Array of price feed IDs to fetch updates for"},options:{type:"object",properties:{encoding:{type:"string",enum:["hex","base64"],description:"Encoding format for the price updates"},parsed:{type:"boolean",description:"Whether to return parsed price updates"}}}}};async function Et(r){try{let e=Xr.compile(Jr);if(!e(r)){let n=e.errors||[];throw elizaLogger.error("Price updates validation failed",{errors:n,data:r}),new h("DATA_VALIDATION_FAILED","Price updates validation failed","HIGH",{errors:n.map(a=>({path:a.schemaPath,message:a.message,params:a.params})),data:r})}return !0}catch(e){throw e instanceof h?e:(elizaLogger.error("Price updates validation error",{error:e instanceof Error?e.message:String(e),data:r}),new h("DATA_SCHEMA_ERROR","Price updates validation error","HIGH",{error:e instanceof Error?e.message:String(e),data:r}))}}var en=W(),tn=en.PYTH_GRANULAR_LOG,k=(r,e)=>{tn&&(elizaLogger.info(`[PriceUpdates] ${r}`,e),console.log(`[PriceUpdates] ${r}`,e?JSON.stringify(e,null,2):""));},He=r=>r.toLowerCase().startsWith("0x")?r.toLowerCase():`0x${r.toLowerCase()}`,vt=r=>r.toLowerCase().startsWith("0x")?r.toLowerCase():`0x${r.toLowerCase()}`,rn={name:"GET_LATEST_PRICE_UPDATES",similes:["FETCH_LATEST_PRICES","GET_CURRENT_PRICES","CHECK_PRICE_FEED"],description:"Retrieve latest price updates from Pyth Network",examples:[[{user:"user",content:{text:"Get latest price updates for 0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43",priceIds:["0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43"],options:{encoding:"base64",parsed:true}}},{user:"assistant",content:{text:"Here is the latest BTC/USD price",success:true,priceIds:["0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43"],data:{updates:[{price_feed_id:"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43",price:42e9,conf:1e8,expo:-8,publish_time:1641034800,ema_price:{price:4195e7,conf:95e6,expo:-8}}]}}}]],validate:async(r,e)=>{if(e.content?.type!=="GET_LATEST_PRICE_UPDATES")return  true;k("Validating GET_LATEST_PRICE_UPDATES action",{content:e.content});try{let t=e.content;if(!t.priceIds&&t.text){let n=t.text.match(/([a-fA-F0-9]{64})/);n&&(t.priceIds=[vt(n[1])]);}t.priceIds&&(t.priceIds=t.priceIds.map(He));try{await Et(t),k("Schema validation passed");}catch(n){throw k("Schema validation failed",{error:n}),n instanceof h?(elizaLogger.error("Schema validation failed",{errors:n.details?.errors}),n):new h("DATA_VALIDATION_FAILED","Schema validation failed","HIGH",{error:n})}if(!t.priceIds||!Array.isArray(t.priceIds))throw new h("DATA_VALIDATION_FAILED","priceIds must be an array of strings","HIGH");if(t.priceIds.length===0)throw new h("DATA_VALIDATION_FAILED","priceIds array cannot be empty","HIGH");if(t.priceIds.forEach((n,a)=>{let s=n.startsWith("0x")?n.slice(2):n;if(!/^[0-9a-fA-F]{64}$/.test(s))throw new h("DATA_VALIDATION_FAILED",`Invalid price ID at index ${a}: ${n}. Must be a 64-character hex string`,"HIGH")}),t.options&&t.options.encoding&&!["hex","base64"].includes(t.options.encoding))throw new h("DATA_VALIDATION_FAILED","Invalid encoding option. Must be 'hex' or 'base64'","HIGH");return !0}catch(t){return k("Validation failed",{error:t}),elizaLogger.error("Validation failed for GET_LATEST_PRICE_UPDATES",{error:t instanceof Error?t.message:String(t)}),false}},handler:async(r,e,t,n={},a)=>{k("Executing GET_LATEST_PRICE_UPDATES action");try{let s=e.content;if(k("Message content received",s),!s.priceIds&&s.text){let T=s.text.match(/([a-fA-F0-9]{64})/);T&&(s.priceIds=[vt(T[1])]);}s.priceIds&&(s.priceIds=s.priceIds.map(He));let{priceIds:i,options:o={}}=s;k("Extracted values",{priceIds:i,options:o});let c=await $(r);if(!c)throw new h("DATA_VALIDATION_FAILED","Invalid Pyth configuration","HIGH");let l=X(c.PYTH_NETWORK_ENV),m=new HermesClient(l.hermes);k("Initialized HermesClient",{endpoint:l.hermes});try{k("Requesting price updates with params",{priceIds:i,options:o});let T=await m.getLatestPriceUpdates(i,{parsed:!0,encoding:o?.encoding});if(k("Raw response from Hermes",{updates:T}),!T||!T.parsed)throw new Error("No updates received from Hermes");if(k("Successfully retrieved price updates",{updates:T,parsedCount:T.parsed?.length}),a){let S=T.parsed?.map(b=>{let Te=b.metadata,R=Te?.proof_available_time;return `Price Feed: ${He(b.id)}
Current Price: ${(Number(b.price.price)*Math.pow(10,b.price.expo)).toFixed(2)} USD
Confidence: \xB1${(Number(b.price.conf)*Math.pow(10,b.price.expo)).toFixed(2)} USD
EMA Price: ${(Number(b.ema_price.price)*Math.pow(10,b.ema_price.expo)).toFixed(2)} USD
EMA Confidence: \xB1${(Number(b.ema_price.conf)*Math.pow(10,b.ema_price.expo)).toFixed(2)} USD
Last Update: ${new Date(b.price.publish_time*1e3).toLocaleString()}${Te?`
Slot: ${Te.slot}
Proof Available: ${R?new Date(R*1e3).toLocaleString():"Not available"}`:""}`}).join(`

`);a({text:S,success:!0,priceIds:i,data:{updates:T.parsed?.map(b=>({price_feed_id:He(b.id),price:Number(b.price.price),conf:Number(b.price.conf),expo:b.price.expo,publish_time:b.price.publish_time,ema_price:b.ema_price?{price:Number(b.ema_price.price),conf:Number(b.ema_price.conf),expo:b.ema_price.expo}:void 0,metadata:b.metadata}))}});}return !0}catch(T){throw k("Failed to process price updates request",{error:T}),a&&a({text:`Error retrieving price updates: ${T instanceof Error?T.message:String(T)}`,success:!1,priceIds:i,data:{error:T instanceof Error?T.message:String(T)}}),new h("DATA_VALIDATION_FAILED","Failed to process price updates request","HIGH",{originalError:T})}}catch(s){throw k("Failed to get latest price updates",{error:s}),new h("NETWORK_ERROR","Failed to get latest price updates","HIGH",{originalError:s})}}},Tt=rn;var an=new Kr({allErrors:true,verbose:true,coerceTypes:true,useDefaults:true}),sn={type:"object",properties:{text:{type:"string"},success:{type:"boolean"},data:{type:"object",properties:{caps:{type:"array",items:{type:"object",required:["publisher","cap","timestamp"],properties:{publisher:{type:"string",pattern:"^0x[a-fA-F0-9]{40}$"},cap:{type:"number",minimum:0},timestamp:{type:"number",minimum:0}}}},error:{type:"string"}}}}};async function It(r){try{let e=an.compile(sn);if(!e(r)){let n=e.errors||[];throw elizaLogger.error("Publisher caps validation failed",{errors:n,data:r}),new h("DATA_VALIDATION_FAILED","Publisher caps validation failed","HIGH",{errors:n.map(a=>({path:a.schemaPath,message:a.message,params:a.params})),data:r})}return !0}catch(e){throw e instanceof h?e:(elizaLogger.error("Publisher caps validation error",{error:e instanceof Error?e.message:String(e),data:r}),new h("DATA_SCHEMA_ERROR","Publisher caps validation error","HIGH",{error:e instanceof Error?e.message:String(e),data:r}))}}var cn=W(),dn=cn.PYTH_GRANULAR_LOG,V=(r,e)=>{dn&&(elizaLogger.info(`[PublisherCaps] ${r}`,e),console.log(`[PublisherCaps] ${r}`,e?JSON.stringify(e,null,2):""));},ln={name:"GET_LATEST_PUBLISHER_CAPS",similes:["FETCH_PUBLISHER_CAPS","GET_PUBLISHER_LIMITS","CHECK_PUBLISHER_CAPS"],description:"Retrieve latest publisher caps from Pyth Network",examples:[[{user:"user",content:{text:"Get me all the latest publisher caps"}},{user:"assistant",content:{text:"Latest publisher caps",success:true,data:{caps:[{publisher:"0x1234567890abcdef1234567890abcdef12345678",cap:1e6,timestamp:1641034800}]}}}]],validate:async(r,e)=>{if(e.content?.type!=="GET_LATEST_PUBLISHER_CAPS")return  true;V("Validating GET_LATEST_PUBLISHER_CAPS action",{content:e.content});try{let t=e.content;try{await It(t),V("Publisher caps validation passed");}catch(n){throw V("Publisher caps validation failed",{error:n}),n instanceof h?(elizaLogger.error("Publisher caps validation failed",{errors:n.details?.errors}),n):new h("DATA_VALIDATION_FAILED","Publisher caps validation failed","HIGH",{error:n})}return !0}catch(t){return V("Validation failed",{error:t}),elizaLogger.error("Validation failed for GET_LATEST_PUBLISHER_CAPS",{error:t instanceof Error?t.message:String(t)}),false}},handler:async(r,e,t,n={},a)=>{V("Executing GET_LATEST_PUBLISHER_CAPS action");try{let s=await $(r);if(!s)throw new h("DATA_VALIDATION_FAILED","Invalid Pyth configuration","HIGH");let i=X(s.PYTH_NETWORK_ENV),o=new HermesClient(i.hermes);V("Initialized HermesClient",{endpoint:i.hermes});try{let c=await o.getLatestPublisherCaps({parsed:!0});if(!c.parsed?.[0]?.publisher_stake_caps)throw new h("DATA_VALIDATION_FAILED","No publisher caps data found in response","HIGH");let l=c.parsed[0].publisher_stake_caps,m=Date.now();l.forEach((S,b)=>{V(`Publisher Cap ${b+1}`,{publisher:S.publisher,cap:S.cap.toLocaleString(),timestamp:new Date(m).toLocaleString()});}),V("Successfully retrieved publisher caps",{totalCaps:l.length,allCaps:l.map(S=>({publisher:S.publisher,cap:S.cap.toLocaleString(),timestamp:new Date(m).toLocaleString()}))});let T=l.map((S,b)=>`Publisher ${b+1}:
ID: ${S.publisher}
Cap: ${S.cap.toLocaleString()} tokens
Timestamp: ${new Date(m).toLocaleString()}`).join(`

`);return a&&await a({text:`Retrieved ${l.length} publisher caps:

${T}`,success:!0,data:{caps:l.map(S=>({publisher:S.publisher,cap:S.cap,timestamp:m}))}}),!0}catch(c){throw V("Failed to process publisher caps request",{error:c}),c instanceof h?c:new h("DATA_VALIDATION_FAILED","Failed to process publisher caps request","HIGH",{originalError:c})}}catch(s){throw V("Failed to get publisher caps",{error:s}),s instanceof h?s:new h("NETWORK_ERROR","Failed to get publisher caps","HIGH",{originalError:s})}}},At=ln;var pn=un({text:A.cyan("Initializing Pyth Data Plugin..."),spinner:"dots12",color:"cyan"}).start();await new Promise(r=>setTimeout(r,1e3));var Be=[lt,gt,Tt,At];console.log(`
`+A.cyan("\u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510"));console.log(A.cyan("\u2502")+A.yellow.bold("          PYTH DATA PLUGIN             ")+A.cyan(" \u2502"));console.log(A.cyan("\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524"));console.log(A.cyan("\u2502")+A.white("  Initializing Pyth Data Services...    ")+A.cyan("\u2502"));console.log(A.cyan("\u2502")+A.white("  Version: 1.0.0                        ")+A.cyan("\u2502"));console.log(A.cyan("\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518"));pn.succeed(A.green("Pyth Data Plugin initialized successfully!"));var St=new Rt({head:[A.cyan("Action"),A.cyan("H"),A.cyan("V"),A.cyan("E"),A.cyan("Similes")],style:{head:[],border:["cyan"]}});Be.forEach(r=>{St.push([A.white(r.name),typeof r.handler=="function"?A.green("\u2713"):A.red("\u2717"),typeof r.validate=="function"?A.green("\u2713"):A.red("\u2717"),r.examples?.length>0?A.green("\u2713"):A.red("\u2717"),A.gray(r.similes?.join(", ")||"none")]);});console.log(`
`+St.toString());var xt=new Rt({style:{border:["cyan"]}});xt.push([A.cyan("Plugin Status")],[A.white("Name    : ")+A.yellow("pyth-data")],[A.white("Actions : ")+A.green(Be.length.toString())],[A.white("Status  : ")+A.green("Loaded & Ready")]);console.log(`
`+xt.toString()+`
`);var fn={name:"pyth-data",description:"Pyth Data Plugin for price feeds and market data",actions:Be,evaluators:[]};var Ea=fn;export{Ea as default,fn as pythDataPlugin};//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map